# Automated Table Generation Scripts

This directory contains Python scripts that automatically generate LaTeX tables from computational results.

## Overview

These scripts parse the `AllResults_CRRA_2.0_R_1.01.txt` file (generated by `EstimAggFiscalMAIN.py`) and create LaTeX `.ltx` files containing tabular environments. The main paper tables then include these generated files using `\includetabular`.

## Scripts

### 1. `estimBetas_tabular_generate.py`

**Purpose**: Generates Table 4 (Estimated discount factor distributions and estimation targets)

**Input**: `../Results/AllResults_CRRA_2.0_R_1.01.txt`

**Output**: `Tables/CRRA2/estimBetas.ltx`

**Usage**:
```bash
cd Code/HA-Models/FromPandemicCode
python estimBetas_tabular_generate.py
```

**What it extracts**:
- Panel A: (β, ∇) for each education group (lines 4, 14, 24 of AllResults)
- Panel A: Min/max discount factors (lines 10, 20, 30 of AllResults)
- Panel B: Median LW/PI ratios (lines 5, 15, 25 of AllResults)
- Panel B: Empirical targets from SCF 2004 (hardcoded)

### 2. `nonTargetedMoments_tabular_generate.py`

**Purpose**: Generates Table 5 (Model fit with respect to non-targeted moments)

**Input**: `../Results/AllResults_CRRA_2.0_R_1.01.txt`

**Output**: `Tables/CRRA2/nonTargetedMoments.ltx`

**Usage**:
```bash
cd Code/HA-Models/FromPandemicCode
python nonTargetedMoments_tabular_generate.py
```

**What it extracts**:
- Panel A: Wealth shares by education group (line 37 of AllResults)
- Panel A: Average lottery-win-year MPCs by education (line 45 of AllResults)
- Panel B: Wealth shares by wealth quartile (line 38 of AllResults)
- Panel B: Average lottery-win-year MPCs by wealth quartile (line 44 of AllResults)
- Empirical wealth shares from SCF 2004 (hardcoded)

## Integration with Main Workflow

### When to Run

These scripts should be run **after** `EstimAggFiscalMAIN.py` completes, which generates the `AllResults_CRRA_2.0_R_1.01.txt` file.

**Option 1**: Run manually after estimation:
```bash
cd Code/HA-Models/FromPandemicCode
python EstimAggFiscalMAIN.py  # Takes ~21 hours
python estimBetas_tabular_generate.py
python nonTargetedMoments_tabular_generate.py
```

**Option 2**: Integrate into `do_all.py` (Step 2):

Add to `do_all.py` after the estimation step:

```python
# After running EstimAggFiscalMAIN.py
if run_step_2:
    print("\n" + "="*80)
    print("Generating tables from estimation results...")
    print("="*80 + "\n")
    
    import subprocess
    subprocess.run(["python", "estimBetas_tabular_generate.py"], 
                   cwd="Code/HA-Models/FromPandemicCode")
    subprocess.run(["python", "nonTargetedMoments_tabular_generate.py"],
                   cwd="Code/HA-Models/FromPandemicCode")
```

### LaTeX Integration

The generated `.ltx` files are included in the main tables via:

**`Tables/estimBetas.tex`**:
```latex
\includetabular{\latexroot/Code/HA-Models/FromPandemicCode/Tables/CRRA2/estimBetas.ltx}
```

**`Tables/nonTargetedMoments.tex`**:
```latex
\includetabular{\latexroot/Code/HA-Models/FromPandemicCode/Tables/CRRA2/nonTargetedMoments.ltx}
```

## File Structure

```
Code/HA-Models/
├── FromPandemicCode/
│   ├── estimBetas_tabular_generate.py         # Script
│   ├── nonTargetedMoments_tabular_generate.py # Script
│   ├── EstimAggFiscalMAIN.py                  # Generates AllResults
│   ├── Tables/
│   │   └── CRRA2/
│   │       ├── estimBetas.ltx                 # Generated output
│   │       ├── nonTargetedMoments.ltx         # Generated output
│   │       ├── Multiplier.ltx                 # (other auto-generated tables)
│   │       └── welfare6.ltx
│   └── ...
└── Results/
    └── AllResults_CRRA_2.0_R_1.01.txt         # Input data

Tables/
├── estimBetas.tex              # Wrapper (uses \includetabular)
└── nonTargetedMoments.tex      # Wrapper (uses \includetabular)
```

## Error Handling

Both scripts include:
- File existence checks
- Data validation
- Clear error messages
- Exit codes (0 = success, 1 = error)

If a script fails:
1. Check that `AllResults_CRRA_2.0_R_1.01.txt` exists and is complete
2. Check the error message for which data field failed to parse
3. Verify the AllResults file format hasn't changed

## Maintenance

### Updating for Different Parametrizations

To generate tables for other parametrizations (e.g., CRRA1, CRRA3, Splurge0):

1. Modify the scripts to read the appropriate AllResults file
2. Output to the corresponding subdirectory (e.g., `Tables/CRRA1/`, `Tables/Splurge0/`)
3. Update the wrapper `.tex` files to include the correct `.ltx` path

### Adding New Auto-Generated Tables

To add automation for other tables:

1. Create a new `<tablename>_tabular_generate.py` script in this directory
2. Follow the same pattern:
   - Parse AllResults or other output files
   - Generate LaTeX tabular environment
   - Save to `Tables/CRRA2/<tablename>.ltx`
3. Update the wrapper `Tables/<tablename>.tex` to use `\includetabular`
4. Document in this README

## Benefits of Automation

✅ **Reproducibility**: Tables automatically reflect latest computational results

✅ **No transcription errors**: Eliminates manual copy-paste mistakes

✅ **Consistency**: Ensures tables match the code parameters

✅ **Efficiency**: Saves time when re-running estimations

✅ **Versioning**: Tables update automatically with different parametrizations

## Testing

To verify the generated tables match the originals:

```bash
# Generate tables
python estimBetas_tabular_generate.py
python nonTargetedMoments_tabular_generate.py

# Compile LaTeX to check formatting
cd ../../../Tables
latexmk -pdf estimBetas.tex
latexmk -pdf nonTargetedMoments.tex

# Visually compare with previous versions
```

## See Also

- `../../README.md` - Main code documentation
- `../../../Tables/AUTOMATION_OPPORTUNITIES.md` - Analysis of automation opportunities
- `../../../Tables/estimBetas_sources.md` - Provenance documentation
- `../../../Tables/nonTargetedMoments_sources.md` - Provenance documentation (to be created)
- `do_all-README.md` - Table/figure provenance mapping

