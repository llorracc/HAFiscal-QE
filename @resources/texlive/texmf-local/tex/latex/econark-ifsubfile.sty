\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{econark-ifsubfile}[2023/06/14 Define ifsubfile condition]

\RequirePackage{subfiles}

\newif\ifstandalone

% Check if we're in the main file or a subfile
\@ifundefined{document@subtype}{%
  \standalonetrue
  \typeout{econark-ifsubfile: Compiled as standalone or main file}
}{%
  \def\tmp{subfile}%
  \ifx\document@subtype\tmp
    \standalonefalse
    \typeout{econark-ifsubfile: Included as subfile}
  \else
    \standalonetrue
    \typeout{econark-ifsubfile: Compiled as standalone or main file}
  \fi
}

\providecommand{\onlyinsubfile}{}
\providecommand{\notinsubfile}{}
\providecommand{\compilingassubfile}{}
\providecommand{\compilingasstandalone}{}
% New clear macro names for conditional compilation
\providecommand{\whenstandalone}{}
\providecommand{\whenintegrated}{}

% Also provide legacy macros for backward compatibility
\providecommand{\onlyinsubfile}{}
\providecommand{\notinsubfile}{}
\providecommand{\compilingassubfile}{}
\providecommand{\compilingasstandalone}{}

\ifstandalone
  % Define commands to be executed only when compiled standalone or as main file
  \renewcommand{\onlyinsubfile}[1]{}
  \renewcommand{\notinsubfile}[1]{#1}
  \renewcommand{\compilingassubfile}[1]{}
  \renewcommand{\compilingasstandalone}[1]{#1}
  % New clear macro names - content executed when compiling standalone
  \renewcommand{\whenstandalone}[1]{#1}
  \renewcommand{\whenintegrated}[1]{}
\else
  % Define commands to be executed when included as a subfile
  \renewcommand{\onlyinsubfile}[1]{#1}
  \renewcommand{\notinsubfile}[1]{}
  \renewcommand{\compilingassubfile}[1]{#1}
  \renewcommand{\compilingasstandalone}[1]{}
  % New clear macro names - content executed when integrated into main document
  \renewcommand{\whenstandalone}[1]{}
  \renewcommand{\whenintegrated}[1]{#1}
\fi

\endinput
